<!doctype html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARAM Mayhem 台版增幅速查表（重製版）</title>
  <meta name="description" content="英雄聯盟 ARAM: Mayhem 增幅（Augments）台版譯名速查表與建議（依英雄類型）。單檔可直接部署至 GitHub Pages / Cloudflare Pages。">

  <!-- ===== 純原生 CSS（避免外部框架造成樣式衝突） ===== -->
  <style>
    :root{
      --bg:#0b1020; --bg-2:#0f1430;
      --card:#0e1631; --card-2:#0b142b;
      --line:#223056; --line-2:#2d3c6b;
      --txt:#e7eeff; --muted:#9bb1da;
      --accent:#00e0ff; --accent-2:#ff3d78; --accent-3:#7c4dff;
      --ok:#22d3a6; --warn:#ffd166;
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:var(--txt);
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(124,77,255,.16), transparent 60%),
        radial-gradient(900px 500px at 85% 15%, rgba(0,224,255,.16), transparent 60%),
        linear-gradient(180deg, #0b1020 0%, #0b1124 60%, #0b1020 100%);
      font: 14px/1.65 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans", "PingFang TC", "Heiti TC", "Microsoft JhengHei", sans-serif;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    header{
      position:sticky; top:0; z-index:20;
      background: rgba(11,16,32,.78);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(8px);
    }
    .wrap{max-width:1120px; margin:0 auto; padding:12px 16px}
    h1{font-size: clamp(18px, 2.6vw, 28px); margin:0 0 2px; letter-spacing:.3px}
    .sub{color:var(--muted); font-size:12px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap}
    .btn{
      border:1px solid var(--line); background:#0c142e; color:var(--txt);
      padding:10px 14px; border-radius:12px; cursor:pointer; min-height:44px;
      box-shadow:0 2px 10px rgba(0,224,255,.08);
    }
    .btn:hover{border-color:var(--accent); box-shadow:0 4px 18px rgba(0,224,255,.18)}
    .page{display:grid; grid-template-columns:1fr; gap:16px; margin:14px auto}
    @media (min-width: 1024px){ .page{grid-template-columns: 360px 1fr}}
    .card{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(16,22,55,.9), rgba(10,14,30,.9));
      border-radius: var(--radius);
      box-shadow: 0 10px 28px rgba(0,0,0,.30), inset 0 1px 0 rgba(255,255,255,.03);
    }
    .pad{padding:14px}
    .section-title{font-weight:700; letter-spacing:.2px; margin:0 0 10px}
    .tip{color:var(--muted); font-size:12px}
    .field{display:block; width:100%; padding:12px; border-radius:12px; border:1px solid var(--line); background:#0c142e; color:var(--txt)}
    .accent-line{height:1px; background:linear-gradient(90deg, transparent, var(--accent), transparent); margin:10px 0 12px}

    .role-list{display:grid; grid-template-columns:1fr; gap:10px}
    .role-chip{border:1px solid var(--line); border-radius:14px; padding:10px; background: linear-gradient(180deg, #101a40, #0d1635); cursor:pointer; min-height:44px}
    .role-chip.active{outline:2px solid var(--accent); box-shadow: 0 0 0 4px rgba(0,224,255,.12)}

    .hero-grid{display:grid; gap:10px; grid-template-columns: repeat(auto-fill, minmax(104px, 1fr))}
    .hero{display:flex; flex-direction:column; gap:6px; align-items:center; text-align:center; border:1px solid var(--line); border-radius:12px; padding:10px; background:#0b132b; cursor:pointer; min-height:44px}
    .hero:hover{border-color:var(--accent)}
    .hero img{width:80px; aspect-ratio:1/1; border-radius:10px; display:block; background:#0d1838; object-fit:cover}
    .hero .nm{font-size:12px; line-height:1.2; word-break:break-word}
    .hero .en{font-size:10px; color:var(--muted)}

    .rounds{display:grid; gap:16px}
    .badge{display:inline-flex; align-items:center; gap:6px; border:1px solid var(--line-2); padding:3px 8px; border-radius:999px; font-size:11px; color:#cfe2ff}
    .silver{background:linear-gradient(180deg, #18243e,#131b33)}
    .gold{background:linear-gradient(180deg, #3a300f,#241d09); color:#ffe39e; border-color:#6b5418}
    .prismatic{background:linear-gradient(180deg, #2b1640,#170b2b); color:#ead4ff; border-color:#6b2aaa}

    /* Round 內部網格：保證卡片在正確位置且高度一致 */
    .round-card .picks{
      display:grid; gap:10px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      align-items: stretch;
    }
    .pick{
      border:1px solid var(--line); background:#0c142e; border-radius:12px; padding:10px;
      display:grid; grid-template-rows:auto 1fr; min-height:86px;
    }
    .pick .head{display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap}
    .pick .tw{font-weight:700; word-break:break-word}
    .tt{position:relative}
    .ttip{position:absolute; left:50%; top:100%; transform: translate(-50%, 8px); opacity:0; transition:opacity .12s ease, transform .12s ease;
      background:#000; color:#fff; font-size:11px; border-radius:6px; padding:4px 6px; z-index:30; max-width:280px; white-space:nowrap; pointer-events:none}
    .tt:hover .ttip{opacity:1; transform: translate(-50%, 4px)}

    footer{color:#9bb1da; font-size:11px; text-align:center; padding:16px 0 32px}
    footer a{color:var(--accent); text-decoration:none}
    footer a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header>
    <div class="wrap row">
      <div>
        <h1>ARAM Mayhem 台版增幅速查表（重製版）</h1>
        <div class="sub">全英雄（繁中名＋縮圖）／全增幅（台版譯名優先＋英名 tooltip）／行動優化</div>
      </div>
      <div class="row" style="gap:8px">
        <button class="btn" id="copyBtn">複製當前方案</button>
        <button class="btn" id="exportBtn">匯出 JSON</button>
      </div>
    </div>
  </header>

  <main class="wrap page">
    <!-- 左側：類型、搜尋、全英雄 -->
    <aside class="card pad">
      <div class="section-title">選擇英雄類型</div>
      <div class="role-list" id="roleList"></div>

      <div class="accent-line"></div>

      <div class="section-title">快速選英雄</div>
      <input class="field" id="search" placeholder="輸入英雄名稱…（例：拉克絲、Zed）" />
      <div class="accent-line"></div>
      <div class="hero-grid" id="heroGrid" aria-live="polite"></div>

      <div class="accent-line"></div>
      <div class="tip">
        • 英雄繁中名自 Riot Data Dragon（自動抓最新版）<br/>
        • 縮圖優先 OP.GG，失敗退回 DDragon<br/>
        • 增幅名稱以官方／通行譯名為主，無對照則顯示暫譯；英名可懸浮檢視<br/>
        • 第 3 輪可能為金／棱彩；依候選彈性取捨
      </div>
    </aside>

    <!-- 右側：方案 -->
    <section class="rounds">
      <div class="card pad">
        <div class="row">
          <div>
            <div class="tip">目前方案</div>
            <div id="currentPlanTitle" style="font-size:20px; font-weight:800">—</div>
          </div>
          <div class="row" style="gap:6px">
            <span class="badge silver">SILVER</span>
            <span class="badge gold">GOLD</span>
            <span class="badge prismatic">PRISMATIC</span>
          </div>
        </div>
      </div>

      <div id="rounds" class="rounds"></div>
    </section>
  </main>

  <footer>
    資料僅供參考；實裝以遊戲內為準。來源：Mobalytics、OP.GG、Riot Data Dragon。<br/>
    肚府遊戲群DC：
    <a href="https://discord.gg/C9vkSAZmPT" target="_blank" rel="noopener">discord.gg/C9vkSAZmPT</a>
    ｜ 專案作者：
    <a href="https://blessliao.25min.co/" target="_blank" rel="noopener">廖天佑 Bless Liao</a>
  </footer>

  <script>
  // ===== 角色定義與對應色 =====
  const ROLE_META = {
    mage:     { label:'法師 Mage',        colors:['#3d46ff','#00e0ff'] },
    assassin: { label:'刺客 Assassin',     colors:['#ff3d78','#f093fb'] },
    tank:     { label:'坦克 / 肉 Bruiser', colors:['#05d47a','#bafc8b'] },
    adc:      { label:'射手 Marksman',     colors:['#ffb020','#ff3d78'] },
    support:  { label:'輔助 Enchanter',    colors:['#00e0ff','#7c4dff'] },
    fighter:  { label:'鬥士 Fighter',      colors:['#00ffa3','#00e0ff'] }, // DDragon tag 轉換用
  };
  const TAG2ROLE = { Mage:'mage', Assassin:'assassin', Tank:'tank', Marksman:'adc', Support:'support', Fighter:'fighter' };

  // ===== 官方／通行 台版譯名（英→繁） =====
  const OFFICIAL_TW = {
    "Transmute: Prismatic":"質變：稜鏡","Transmute: Gold":"質變：金級","Transmute: Chaos":"質變：大混亂",
    "Jeweled Gauntlet":"寶石手套","Thread the Needle":"穿針引線","Goliath":"巨人","Giant Slayer":"巨人殺手",
    "Marksmage":"射手法師","Scoped Weapons":"狙擊武器","Scopier Weapons":"超狙武器","Scopiest Weapons":"頂狙武器",
    "Lightning Strikes":"電光石火","Magic Missile":"魔法導彈","Typhoon":"颱風","Dual Wield":"雙持射擊",
    "Fan the Hammer":"連轟扳機","Goldrend":"淘金者","Gash":"裂甲真傷",
    "Celestial Body":"天界之身","Courage of the Colossus":"巨像勇氣","Adamant":"剛毅","Shrink Ray":"縮小光線",
    "Veil of Warding":"驅咒之幕","Perseverance":"堅忍不拔","Tank Engine":"坦克引擎","Back to Basics":"回歸基礎",
    "Unkillable Demon King":"不死魔王",
    "Holy Fire":"聖焰灼身","Infernal Conduit":"煉獄導管","Soul Siphon":"靈魂虹吸","Symphony of War":"戰爭交響曲",
    "Ethereal Weapon":"以太武裝","Windspeaker's Blessing":"風語者的祝福","Spiritual Purification":"靈能淨化","Searing Dawn":"曙光灼燒",
    "With Haste":"腳程加速","Leg Day":"腿部訓練日","Flashy":"閃現達人","Snowball Upgrade":"雪球升級",
    "Biggest Snowball Ever":"巨無霸雪球","Fetch":"你丟我撿","Shadow Runner":"影行者","Swift and Safe":"疾衝護身",
    "All for You":"全力支援","Executioner":"處決者","It’s Critical":"就是要爆","It's Critical":"就是要爆",
    "It’s Killing Time":"殺戮時間","It's Killing Time":"殺戮時間","From Beginning to End":"始終如一",
    "Minionmancer":"傀儡增幅","Rabble Rousing":"群起鬥毆","Restless Restoration":"移動療癒","Overflow":"溢流",
    "Skilled Sniper":"神射手訓練","Slow and Steady":"慢即是穩","Snowball Roulette":"雪球輪盤","Stats on Stats!":"疊上加疊！",
    "Quest: Steel Your Heart":"任務：心鋼起來","Quest: Wooglet’s Witchcap":"任務：烏莉特的法帽","Quest: Urf’s Champion":"任務：阿福英雄",
    "King Me":"封我為王",
    "Baby Kitty":"黏踢踢寶貓","Blade Waltz":"劍舞","Can't Touch This":"別碰我","Circle of Death":"死亡環",
    "Clown College":"小丑學院","Cruelty":"無情","Dashing":"縱躍專精","Draw Your Sword":"拔劍吧",
    "Empyrean Promise":"天墜護佑","Eureka":"靈光一現","Feel the Burn":"群體引燃","Fey Magic":"妖精魔法",
    "Final Form":"最終形態","Glass Cannon":"玻璃大砲","Laser Heal":"治療雷射","Mad Scientist":"瘋狂科學家",
    "Master of Duality":"雙修大師","Mystic Punch":"秘拳","Ominous Pact":"不祥之約",
    "Omni Soul":"萬魂加持","Protein Shake":"蛋白奶昔","Quantum Computing":"量子運算","Raid Boss":"團戰首領",
    "Scopiest Weapons":"最神射","Slow Cooker":"慢燉之火","Spirit Link":"靈魂連結","Tap Dancer":"踢踏舞",
    "Ultimate Awakening":"究極甦醒","Ultimate Revolution":"究極輪迴","Upgrade Mikael’s Blessing":"升級米凱爾",
    "Wisdom of Ages":"歲月智慧"
  };

  // ===== 常用增幅（顯示時會套 OFFICIAL_TW；此表只放你方案會用到的）=====
  const AUGMENTS = [
    // Silver
    {en:'ADAPt',               tw:'AD 轉術',       tier:'silver',  note:'AD→AP 混傷加成 + 額外 AP'},
    {en:'Witchful Thinking',   tw:'術力滿點',       tier:'silver',  note:'+AP（20~80）'},
    {en:'Frost Wraith',        tw:'霜魂幽縛',       tier:'silver',  note:'每 6.5 秒對近敵定根'},
    {en:'Shadow Runner',       tw:'影行者',         tier:'silver',  note:'位移/脫隱後 +300 移速'},
    {en:'Swift and Safe',      tw:'疾衝護身',       tier:'silver',  note:'位移後獲護盾（短 CD）'},
    {en:'The Brutalizer',      tw:'殘暴者',         tier:'silver',  note:'+AD +AH +穿甲'},
    {en:'Adamant',             tw:'剛毅',           tier:'silver',  note:'定身疊雙抗'},
    {en:'Tank It or Leave It', tw:'要坦就坦',       tier:'silver',  note:'暴擊轉為格擋幾率，觸發 20% 減傷'},
    {en:'Mighty Shield',       tw:'護盾激勵',       tier:'silver',  note:'獲盾後短時間 +自適應力'},
    {en:'Deft',                tw:'身手敏捷',       tier:'silver',  note:'+60% 攻速'},
    {en:'Scoped Weapons',      tw:'狙擊武器',       tier:'silver',  note:'+射程（近+75/遠+50）'},
    {en:'Typhoon',             tw:'颱風',           tier:'silver',  note:'普攻額外射向另一目標並套 on-hit'},
    {en:'First Aid Kit',       tw:'急救包',         tier:'silver',  note:'治癒/護盾效果 +20%'},
    {en:'Virtuous Cycle',      tw:'善循環',         tier:'silver',  note:'治→盾／盾→治（+20%）'},
    {en:'Sonic Boom',          tw:'音爆共鳴',       tier:'silver',  note:'你加隊友時，周邊敵人受真傷/緩速'},

    // Gold
    {en:'Magic Missile',       tw:'魔彈齊發',       tier:'gold',    note:'技能命中發出 3 枚魔彈，依最大 HP 真傷'},
    {en:'Recursion',           tw:'遞歸冷卻',       tier:'gold',    note:'+60 技能急速'},
    {en:'With Haste',          tw:'疾步如飛',       tier:'gold',    note:'依技能急速轉移速'},
    {en:'Flashy',              tw:'閃現達人',       tier:'gold',    note:'閃現改為彈藥制，CD 短'},
    {en:'Executioner',         tw:'處決者',         tier:'gold',    note:'對 30% 以下增傷；擊殺退小技'},
    {en:"It's Killing Time",   tw:'屠戮時刻',       tier:'gold',    note:'放大標記蓄傷；5 秒引爆'},
    {en:'Perseverance',        tw:'堅忍不拔',       tier:'gold',    note:'巨幅生命回復；殘血更高'},
    {en:"Dawnbringer's Resolve",tw:'黎明守護',      tier:'gold',    note:'半血觸發大治療（死後重置）'},
    {en:'Tank Engine',         tw:'坦克引擎',       tier:'gold',    note:'擊殺疊體型/最大 HP（死掉層）'},
    {en:'Critical Rhythm',     tw:'致命節奏*',      tier:'gold',    note:'爆擊給攻速（可疊）'},
    {en:"It's Critical",       tw:'就是要爆',       tier:'gold',    note:'暴擊率 50%'},
    {en:'Thread the Needle',   tw:'穿雲裂甲',       tier:'gold',    note:'+18% 穿甲/穿魔'},
    {en:'All for You',         tw:'全力支援',       tier:'gold',    note:'你給隊友的治/盾 +30%'},
    {en:'Holy Fire',           tw:'聖焰灼身',       tier:'gold',    note:'治/盾時對近敵灼燒（可疊）'},
    {en:'Keystone Conjurer',   tw:'召喚雙符',       tier:'gold',    note:'同時擁有 Aery + Comet'},
    {en:'Divine Intervention', tw:'神聖干預',       tier:'gold',    note:'降星幕 2.5 秒範圍無敵（CD）'},

    // Prismatic
    {en:'Jeweled Gauntlet',    tw:'珠寶手套',       tier:'prismatic', note:'法術可暴擊並提高爆傷'},
    {en:'Infernal Conduit',    tw:'煉獄導管',       tier:'prismatic', note:'技能施加無限疊灼燒，灼燒縮短冷卻'},
    {en:'Ultimate Awakening',  tw:'究極甦醒',       tier:'prismatic', note:'放大後重置所有小技能'},
    {en:'Quantum Computing',   tw:'量子運算',       tier:'prismatic', note:'每 30 秒自動釋放大範圍斬擊'},
    {en:'Back to Basics',      tw:'回歸基礎',       tier:'prismatic', note:'封大；+35% 技能傷/治/盾與 +70AH'},
    {en:'Final Form',          tw:'最終形態',       tier:'prismatic', note:'放大後護盾/全能吸血/移速'},
    {en:'Blade Waltz',         tw:'劍舞',           tier:'prismatic', note:'無目標連斬並短暫無敵'},
    {en:'Dashing',             tw:'縱躍專精',       tier:'prismatic', note:'所有位移類技能 +175AH'},
    {en:"Can't Touch This",    tw:'別碰我',         tier:'prismatic', note:'放大獲 2 秒無敵'},
    {en:'Glass Cannon',        tw:'玻璃大砲',       tier:'prismatic', note:'-30% 最大 HP；+12% 真傷'},
    {en:'Giant Slayer',        tw:'巨人殺手',       tier:'prismatic', note:'變小加速；對大型敵人增傷'},
    {en:'Courage of the Colossus', tw:'巨像之勇',  tier:'prismatic', note:'定身後獲大護盾'},
    {en:'Goliath',             tw:'巨靈化身',       tier:'prismatic', note:'+體型 +HP +自適應力'},
    {en:'Protein Shake',       tw:'蛋白奶昔',       tier:'prismatic', note:'治癒依雙抗提升'},
    {en:'Omni Soul',           tw:'萬魂加持',       tier:'prismatic', note:'一次獲得 3 個隨機龍魂'},
    {en:"Windspeaker's Blessing", tw:'風語者祝福', tier:'prismatic', note:'治/盾同時給雙抗（範圍）'},
    {en:'Dual Wield',          tw:'雙持射擊',       tier:'prismatic', note:'普攻追加第二發（40% on-hit）'},
    {en:'Fan the Hammer',      tw:'連轟扳機',       tier:'prismatic', note:'普攻向四方再發 5 發'},
    {en:'Goldrend',            tw:'淘金者',         tier:'prismatic', note:'命中給移速與金幣（對同一人有 CD）'}
  ];

  // ===== 類型推薦（固定順序，確保「位置」不被動態排序打亂）=====
  const ROLE_PLANS = {
    mage: [
      { label:'Round 1（建議：銀）',  picks:[ 'ADAPt','Witchful Thinking','Frost Wraith' ] },
      { label:'Round 2（建議：金）',  picks:[ 'Magic Missile','Recursion','With Haste' ] },
      { label:'Round 3（金 / 棱彩）', picks:[ 'Jeweled Gauntlet','Infernal Conduit','Ultimate Awakening' ] },
      { label:'Round 4（棱彩）',      picks:[ 'Quantum Computing','Back to Basics','Final Form' ] },
    ],
    assassin: [
      { label:'Round 1（建議：銀）',  picks:[ 'Shadow Runner','Swift and Safe','The Brutalizer' ] },
      { label:'Round 2（建議：金）',  picks:[ 'Flashy','Executioner',"It's Killing Time" ] },
      { label:'Round 3（金 / 棱彩）', picks:[ 'Blade Waltz','Dashing','Final Form' ] },
      { label:'Round 4（棱彩）',      picks:[ "Can't Touch This",'Glass Cannon','Giant Slayer' ] },
    ],
    tank: [
      { label:'Round 1（建議：銀）',  picks:[ 'Adamant','Tank It or Leave It','Mighty Shield' ] },
      { label:'Round 2（建議：金）',  picks:[ 'Perseverance',"Dawnbringer's Resolve",'Tank Engine' ] },
      { label:'Round 3（金 / 棱彩）', picks:[ 'Courage of the Colossus','Goliath','Protein Shake' ] },
      { label:'Round 4（棱彩）',      picks:[ 'Back to Basics','Omni Soul','Final Form' ] },
    ],
    adc: [
      { label:'Round 1（建議：銀）',  picks:[ 'Deft','Scoped Weapons','Typhoon' ] },
      { label:'Round 2（建議：金）',  picks:[ 'Critical Rhythm',"It's Critical",'Thread the Needle' ] },
      { label:'Round 3（金 / 棱彩）', picks:[ 'Dual Wield','Fan the Hammer','Goldrend' ] },
      { label:'Round 4（棱彩）',      picks:[ 'Giant Slayer','Glass Cannon','Final Form' ] },
    ],
    support: [
      { label:'Round 1（建議：銀）',  picks:[ 'First Aid Kit','Virtuous Cycle','Sonic Boom' ] },
      { label:'Round 2（建議：金）',  picks:[ 'All for You','Holy Fire','Keystone Conjurer' ] },
      { label:'Round 3（金 / 棱彩）', picks:[ 'Empyrean Promise','Divine Intervention',"Windspeaker's Blessing" ] },
      { label:'Round 4（棱彩）',      picks:[ "Windspeaker's Blessing",'Final Form','Omni Soul' ] },
    ],
  };

  // ===== 狀態 =====
  const state = {
    role:'mage',
    heroKey:null, heroNameTw:null,
    version:null, champions:[] // {key,en,tw,role,tags,icons:[opgg,opggAlt,ddragon]}
  };

  // ===== DOM =====
  const $roleList  = document.getElementById('roleList');
  const $search    = document.getElementById('search');
  const $heroGrid  = document.getElementById('heroGrid');
  const $title     = document.getElementById('currentPlanTitle');
  const $rounds    = document.getElementById('rounds');
  const $copyBtn   = document.getElementById('copyBtn');
  const $exportBtn = document.getElementById('exportBtn');

  // ===== OP.GG 圖示與 Fallback =====
  function deriveOpggName(imageFull){
    let base = (imageFull||'').replace(/\.png$/i,'');
    const map = {
      'Chogath':'Chogath','Velkoz':'Velkoz','Leblanc':'Leblanc','Kaisa':'Kaisa','Khazix':'Khazix',
      'KogMaw':'KogMaw','KSante':'KSante','Belveth':'Belveth','Nunu':'Nunu','Wukong':'Wukong',
      'Renata':'Renata','JarvanIV':'JarvanIV','DrMundo':'DrMundo','MissFortune':'MissFortune','MonkeyKing':'Wukong'
    };
    return map[base] || base;
  }
  const opggPrimary = (name) => `https://opgg-static.akamaized.net/meta/images/lol/champion/${name}.png`;
  const opggAlt     = (name) => `https://opgg-static.akamaized.net/images/lol/champion/${name}.png`;
  const ddragonIcon = (ver, full) => `https://ddragon.leagueoflegends.com/cdn/${ver}/img/champion/${full}`;

  // ===== 載入英雄（最新 DDragon + zh_TW）=====
  async function loadChampions(){
    const ver = await fetch('https://ddragon.leagueoflegends.com/api/versions.json').then(r=>r.json()).then(a=>a[0]);
    state.version = ver;
    const data = await fetch(`https://ddragon.leagueoflegends.com/cdn/${ver}/data/zh_TW/champion.json`).then(r=>r.json());
    const champs = Object.values(data.data);
    state.champions = champs.map(c=>{
      const role = TAG2ROLE[c.tags?.[0]] || 'fighter';
      const op = deriveOpggName(c.image.full);
      return {
        key: c.id, en: c.id, tw: c.name, role, tags: c.tags||[],
        icons: [opggPrimary(op), opggAlt(op), ddragonIcon(ver, c.image.full)]
      };
    }).sort((a,b)=> a.tw.localeCompare(b.tw,'zh-Hant'));
    if(!state.heroKey){ state.heroKey = state.champions[0].key; state.heroNameTw = state.champions[0].tw; }
    renderAll();
  }

  // ===== 小工具 =====
  function findAug(en){ return AUGMENTS.find(a=>a.en===en) || {en, tw: en, tier:'silver', note:''}; }
  function showName(en, tw){ return OFFICIAL_TW[en] || tw; }
  function tierBadge(t){
    if(t==='gold') return '<span class="badge gold">GOLD</span>';
    if(t==='prismatic') return '<span class="badge prismatic">PRISMATIC</span>';
    return '<span class="badge silver">SILVER</span>';
  }
  function tierGroupBadge(tiers){
    const order = ['silver','gold','prismatic'];
    const uniq = Array.from(new Set(tiers)).sort((a,b)=> order.indexOf(a)-order.indexOf(b));
    return uniq.map(t=>tierBadge(t)).join(' ');
  }

  // ===== 渲染 =====
  function renderRoles(){
    $roleList.innerHTML = Object.keys(ROLE_META).map(key=>{
      const active = state.role===key; const meta = ROLE_META[key];
      return `
        <button class="role-chip ${active?'active':''}" data-role="${key}">
          <div style="display:flex;align-items:center;gap:10px">
            <div style="width:10px;height:10px;border-radius:50%;background: radial-gradient(circle at 30% 30%, ${meta.colors[0]}, ${meta.colors[1]})"></div>
            <div style="font-weight:700">${meta.label}</div>
          </div>
        </button>`;
    }).join('');
    $roleList.querySelectorAll('[data-role]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ state.role = btn.getAttribute('data-role'); renderAll(); });
    });
  }

  function buildHeroCard(h){
    const [icon1, icon2, fallback] = h.icons;
    const onerr = `if(this.dataset.step!=='1'){this.dataset.step='1';this.src='${icon2}'}else{this.src='${fallback}'}`;
    return `
      <button class="hero" data-hero="${h.key}">
        <img loading="lazy" alt="${h.tw} / ${h.en}" src="${icon1}" onerror="${onerr}"/>
        <div class="nm">${h.tw}</div>
        <div class="en">${h.en}</div>
      </button>
    `;
  }

  function renderHeroes(){
    const q = ($search.value||'').trim().toLowerCase();
    const list = state.champions.filter(c=> !q || c.tw.toLowerCase().includes(q) || c.en.toLowerCase().includes(q));
    $heroGrid.innerHTML = list.map(buildHeroCard).join('');
    $heroGrid.querySelectorAll('[data-hero]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const key = btn.getAttribute('data-hero');
        const obj = state.champions.find(x=>x.key===key);
        if(!obj) return;
        state.heroKey = obj.key; state.heroNameTw = obj.tw; state.role = TAG2ROLE[obj.tags?.[0]] || 'fighter';
        renderAll();
      });
    });
  }

  function renderPlan(){
    const hero = state.champions.find(x=>x.key===state.heroKey);
    const role = hero? (TAG2ROLE[hero.tags?.[0]] || 'fighter') : state.role;
    const flow = ROLE_PLANS[role]||[];
    const heroNameTw = hero? hero.tw : (state.heroNameTw||'—');
    const roleLabel = ROLE_META[role]?.label || role;
    $title.textContent = `${roleLabel}｜${heroNameTw}`;

    $rounds.innerHTML = flow.map(round=>{
      const picks = round.picks.map(en => findAug(en));
      const tiers = picks.map(p=>p.tier);
      const headerBadges = tierGroupBadge(tiers);

      const items = picks.map(a=>{
        const nameZh = showName(a.en, a.tw);
        const note = a.note && a.note.trim() ? a.note : '— 暫無中文簡述 —';
        return `
          <div class="pick">
            <div class="head">
              <div class="tt"><span class="tw">${nameZh}</span><div class="ttip">${a.en}</div></div>
              ${tierBadge(a.tier)}
            </div>
            <div class="tip">${note}</div>
          </div>
        `;
      }).join('');

      return `
        <div class="card pad round-card">
          <div class="row" style="margin-bottom:8px">
            <div class="section-title">${round.label}</div>
            <div>${headerBadges}</div>
          </div>
          <div class="picks">${items}</div>
        </div>
      `;
    }).join('');
  }

  function copyPlan(){
    const hero = state.champions.find(x=>x.key===state.heroKey);
    const role = hero? (TAG2ROLE[hero.tags?.[0]] || 'fighter') : state.role;
    const plan = ROLE_PLANS[role]||[];
    const lines = [];
    const heroNameTw = hero? hero.tw : (state.heroNameTw||'—');
    lines.push(`【${ROLE_META[role]?.label||role}｜${heroNameTw}】ARAM Mayhem 推薦增幅（固定順序）`);
    plan.forEach(r=>{
      lines.push(`- ${r.label}：` + r.picks.map(en=>{ const a=findAug(en); return `${showName(a.en,a.tw)}(${a.en})`; }).join(' / '));
    });
    lines.push('— 名稱以台版常見譯名為準；實戰以客戶端顯示為最終');
    navigator.clipboard.writeText(lines.join('\n'));
    $copyBtn.textContent='已複製'; setTimeout(()=>{$copyBtn.textContent='複製當前方案'},1200);
  }

  function exportJSON(){
    const blob = new Blob([JSON.stringify({version:state.version, champions:state.champions, augments:AUGMENTS, officialTW:OFFICIAL_TW}, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href = url; a.download = 'aram-mayhem-full.tw.json'; a.click(); URL.revokeObjectURL(url);
  }

  function renderAll(){ renderRoles(); renderHeroes(); renderPlan(); }

  // 綁事件
  $copyBtn.addEventListener('click', copyPlan);
  $exportBtn.addEventListener('click', exportJSON);
  $search.addEventListener('input', renderHeroes);

  // 啟動
  loadChampions().catch(err=>{
    console.error(err);
    // 若 DDragon 無法載入，至少不讓頁面掛掉
    state.version = 'latest';
    state.champions = [];
    renderAll();
  });
  </script>
</body>
</html>
